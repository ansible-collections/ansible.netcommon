---
- name: "{{ parser }} Run command and parse with xml"
  ansible.utils.cli_parse:
    command: "show interface | xml"
    parser:
      name: ansible.utils.xml
  register: nxos_xml_command

# TODO: This testcase test the redirection of cli_parse plugin
# from ansible.netcommon to ansible.utils
# remove this test case after ansible.netcommon.cli_parse deprecation is
# due as this scenario is already covered in ansible.utils collection testing
- name: "{{ parser }} Pass text and parse with xml"
  ansible.netcommon.cli_parse:
    text: "{{ nxos_xml_command['stdout'] }}"
    parser:
      name: ansible.netcommon.xml
  register: nxos_xml_text

- name: "{{ parser }} Confirm response"
  assert:
    that: "{{ item }}"
  with_items:
    - "{{ nxos_xml_command['stdout'] is defined }}"
    - "{{ nxos_xml_command['stdout_lines'] is defined }}"
    - "{{ nxos_xml_command['parsed'] == nxos_xml_text['parsed'] }}"
    - "{{ nxos_xml_command['parsed']['nf:rpc-reply'] is defined }}"
